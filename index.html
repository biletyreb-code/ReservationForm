<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
    <title>Rezerwacja - Świąteczny Pociąg</title>

    <style>
        /* --- CSS (BEZ ZMIAN) --- */
        :root {
            --kolor-tla: #f7f7f5;
            --kolor-akcentu: #8b0000;
            --kolor-glowny: #004d40;
            --kolor-tekstu: #333333;
            --cien-delikatny: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box; 
        }
        body {
            font-family: 'Georgia', serif;
            background-color: var(--kolor-tla);
            color: var(--kolor-tekstu);
            margin: 0;
            padding: 0; 
            line-height: 1.6;
        }

        h2 {
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
            color: var(--kolor-glowny);
            text-align: center;
            margin: 20px 0 30px; 
            letter-spacing: 1px;
            font-size: 1.6em; 
            padding: 0 10px;
        }

        form {
            max-width: 600px; 
            margin: 0 auto; 
            background: #ffffff;
            padding: 20px; 
            border-radius: 0;
            box-shadow: none;
            border-top: 5px solid var(--kolor-akcentu);
            min-height: 100vh;
        }

        label {
            display: block;
            font-weight: bold;
            margin-top: 15px;
            color: var(--kolor-glowny);
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="tel"],
        select {
            width: 100%; 
            padding: 14px;
            margin-top: 6px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            box-sizing: border-box;
            transition: border-color 0.3s;
            font-size: 16px;
        }

        .rodo-group {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px dashed #e0e0e0;
        }
        
        .rodo-checkbox-container {
            display: flex;
            align-items: flex-start;
            margin-top: 15px;
        }

        .rodo-checkbox-container input[type="checkbox"] {
            flex-shrink: 0; 
            width: 20px;
            height: 20px;
            margin-top: 4px;
            margin-right: 10px;
        }
        
        .rodo-text {
            flex-grow: 1;
            font-size: 0.9em;
            color: #666;
        }

        .rodo-admin-info {
            font-size: 0.8em;
            color: #999;
            margin-top: 10px;
            text-align: center;
        }
        
        button {
            margin-top: 30px;
            width: 100%;
            padding: 16px 20px;
            background-color: var(--kolor-akcentu);
            border: none;
            color: white;
            font-size: 18px;
            border-radius: 4px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: background-color 0.3s, opacity 0.3s;
        }

        button:hover:not(:disabled) {
            background-color: #a00000;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .success {
            text-align: center;
            margin-top: 20px;
            color: var(--kolor-glowny);
            font-weight: bold;
        }
        
        @media (min-width: 600px) {
            body {
                padding: 24px;
            }
            form {
                border-radius: 8px; 
                box-shadow: var(--cien-delikatny);
                padding: 30px;
                margin: auto;
                min-height: auto;
            }
            h2 {
                font-size: 1.8em;
            }
        }
    </style>
</head>

<body>
    <h2>Rezerwacja Przejazdu Mikołajkowym Pociągiem</h2>

    <form id="submitForm">
        <label for="date">Data Przejazdu</label>
        <select id="date" name="date" required onchange="updateStops(); checkFormValidity();">
            <option value="" disabled selected>Wybierz datę</option>
            <option value="07.12.2025">07.12.2025</option>
        </select>

        <label for="firstName">Imię</label>
        <input type="text" id="firstName" name="firstName" required oninput="checkFormValidity();" />

        <label for="lastName">Nazwisko</label>
        <input type="text" id="lastName" name="lastName" required oninput="checkFormValidity();" />

        <label for="seats">Ilość miejsc</label>
        <input type="number" id="seats" name="seats" min="1" max="8" required oninput="checkFormValidity();" />

        <label for="stop1">Stacja początkowa</label>
        <select id="stop1" name="stop1" required disabled onchange="checkFormValidity();">
            <option value="" disabled selected>Wybierz datę, aby zobaczyć przystanki</option>
        </select>

        <label for="stop2">Stacja końcowa</label>
        <select id="stop2" name="stop2" required disabled onchange="checkFormValidity();">
            <option value="" disabled selected>Wybierz datę, aby zobaczyć przystanki</option>
        </select>

        <label for="phone">Telefon</label>
        <input type="tel" id="phone" name="phone" required oninput="checkFormValidity();" />

        <label for="email">Email</label>
        <input type="email" id="email" name="email" required oninput="checkFormValidity();" />

        <label for="isReturn">Powrót</label>
        <select id="isReturn" name="isReturn" required onchange="checkFormValidity();">
            <option value="Nie">Nie</option>
            <option value="Tak">Tak</option>
        </select>
        
        <div class="rodo-group">
            <div class="rodo-checkbox-container">
                <input type="checkbox" id="rodoAccept" required onclick="checkFormValidity();">
                <label for="rodoAccept" class="rodo-text">
                    Oświadczam, że zapoznałem/am się i **zgadzam na przetwarzanie** moich danych osobowych w celu realizacji usługi przewozu oraz kontaktu, zgodnie z RODO.
                </label>
            </div>
            
            <p class="rodo-admin-info">
                Administratorem danych jest: <strong>SKPL Cargo Sp. z o.o.</strong><br>
                Adres: Zbiersk Cukrownia 54, 62-830 Zbiersk, NIP: 9680951169.
            </p>
        </div>


        <button type="submit" disabled>Wyślij Rezerwację</button>

        <p class="success" id="successMsg" style="display:none;">Dane wysłane pomyślnie! Dziękujemy za rezerwację.</p>
    </form>

    <script>
        // ZMIEŃ NA SWÓJ URL DEPLOYMENTU
        const scriptURL = "https://script.google.com/macros/s/AKfycbyac0BUjUXWP2DkofJO57aQzqLZN0djPLKkwkzAPaM0X80MB_DSgsM5sPOEYeWFS8IA/exec";

        // Dane przystanków dla stacji początkowej (pełna lista dla 07.12.2025)
        const allStops = [
            "Besko", "Czaszyn", "Humenne", "Jasło", "Jedlicze", "Komańcza", "Komańcza Letnisko",
            "Krosno", "Krosno Miasto", "Łupków", "Medzilaborce", "Medzilaborce Mesto",
            "Mokre Małopolskie", "Morochów", "Nowy Łupków", "Nowy Zagórz", "Rzepedź", "Sanok",
            "Stakcin", "Szczawne Kulaszne", "Targowiska", "Tarnawa Dolna", "Wróblik Szlachecki",
            "Wysoczany", "Zagórz", "Zarszyn"
        ];
        
        // Dane przystanków dla stacji końcowej (ograniczona lista)
        const destinationStops = [
            "Medzilaborce",
            "Medzilaborce Mesto",
            "Stakcin",
            "Humenne"
        ];

        /**
         * Funkcja wypełniająca listy przystanków na podstawie wybranej daty.
         */
        function updateStops() {
            const dateSelect = document.getElementById("date");
            const stop1Select = document.getElementById("stop1");
            const stop2Select = document.getElementById("stop2");
            const selectedDate = dateSelect.value;

            // Używamy pełnej listy dla stop1
            const stopsForStart = allStops;
            // Używamy ograniczonej listy dla stop2
            const stopsForEnd = destinationStops;

            // Reset i wyłączenie pól
            stop1Select.innerHTML = '<option value="" disabled selected>Wybierz przystanek</option>';
            stop2Select.innerHTML = '<option value="" disabled selected>Wybierz przystanek</option>';
            stop1Select.disabled = true;
            stop2Select.disabled = true;

            if (selectedDate === "07.12.2025") {
                // 1. Wypełnij STACJĘ POCZĄTKOWĄ (pełna lista)
                stopsForStart.forEach(stop => {
                    stop1Select.add(new Option(stop, stop));
                });
                stop1Select.disabled = false;

                // 2. Wypełnij STACJĘ KOŃCOWĄ (ograniczona lista)
                stopsForEnd.forEach(stop => {
                    stop2Select.add(new Option(stop, stop));
                });
                stop2Select.disabled = false;
            } else if (selectedDate) {
                // Komunikat, gdy lista dla wybranej daty jest pusta (chociaż w tym kodzie to się nie wydarzy, bo jest tylko 07.12)
                stop1Select.innerHTML = '<option value="" disabled selected>Brak przystanków dla tej daty</option>';
                stop2Select.innerHTML = '<option value="" disabled selected>Brak przystanków dla tej daty</option>';
            }
            // Sprawdź ważność formularza po aktualizacji przystanków
            checkFormValidity();
        }

        /**
         * Funkcja sprawdzająca ważność całego formularza
         * i aktywująca/dezaktywująca przycisk "Wyślij Rezerwację".
         */
        function checkFormValidity() {
            const form = document.getElementById("submitForm");
            const rodoChecked = document.getElementById("rodoAccept").checked;
            const submitButton = form.querySelector('button[type="submit"]');

            const isFormValid = form.checkValidity() && rodoChecked;

            submitButton.disabled = !isFormValid;
        }

        // Dodanie nasłuchiwania zdarzenia 'submit'
        document.getElementById("submitForm").addEventListener("submit", function(e) {
            e.preventDefault();

            if (!document.getElementById("rodoAccept").checked) {
                alert("Proszę zaakceptować warunki RODO, aby kontynuować rezerwację.");
                return;
            }

            const formData = new FormData(this);
            const params = new URLSearchParams(formData).toString();

            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.textContent = "Wysyłanie...";
            submitButton.disabled = true;

            document.getElementById("successMsg").style.display = "none";

            fetch(scriptURL + "?" + params, { method: "GET" })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Odpowiedź serwera nie jest OK');
                })
                .then(() => {
                    document.getElementById("successMsg").style.display = "block";
                    this.reset();
                    updateStops();
                    document.getElementById("rodoAccept").checked = false;
                })
                .catch(err => {
                    alert("Błąd podczas wysyłania danych: " + err);
                })
                .finally(() => {
                    submitButton.textContent = "Wyślij Rezerwację";
                    checkFormValidity(); 
                });
        });
        
        // --- Inicjalizacja ---
        updateStops();
        const formElements = document.querySelectorAll('#submitForm input, #submitForm select');
        formElements.forEach(element => {
            if (element.id !== 'rodoAccept' && element.tagName !== 'BUTTON') {
                element.addEventListener('change', checkFormValidity);
                element.addEventListener('input', checkFormValidity);
            }
        });
        checkFormValidity();
    </script>
</body>
</html>
